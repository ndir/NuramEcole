<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//FR" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--  V 0.1 : Maj : 09/11/2007 -->

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:rich="http://richfaces.ajax4jsf.org/rich"
	xmlns:a="https://ajax4jsf.dev.java.net/ajax"
	xmlns:t="http://myfaces.apache.org/tomahawk"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:c="http://java.sun.com/jstl/core"
	template="/template/template.xhtml">
	<!-- Page d'accueil -->





	<ui:define name="title">#{msgBundle['gestock.titre.vente']}</ui:define>
	<ui:define name="body">
		<h:form id="note">

			
			<div class="zoneResultat2" style="height:600px;overflow: auto"  >
			
	   		<table> <tr> 
			     <!--  <td> <s:graphicImage fileName="candidat_64.png" style="border:0px;" value="/picto/candidat_64.png" width="10" height="10" alt="Peupler" /> </td> --> 
			        <td> <h1> #{msgBundle['gestock.titre.vente']}  </h1>  </td> 
			      </tr>    
			</table>  					 
			
			
			
			<rich:panel header="#{msgBundle['gestock.titre.vente']} : #{venteService.caisseEncours.libelle} ">
			
			<fieldset>
			
			
			<table width="100%">
			<tr>  
				<td> <h:outputText value="#{msgBundle['gestock.estClient']} :  " styleClass="grey" /> 
				 <h:selectBooleanCheckbox value="#{venteService.distributeurON}" valueChangeListener="#{venteService.changerTypeFournisseur}" 
				 disabled="#{venteService.venteEnCoures.getListeDetailVente().size()!=0}" >
								                      	<a:support event="onchange" bypassUpdates="true"
															ajaxSingle="true" status="waitStatus"
															reRender="idFournisseur,lab"
															oncomplete="dateEtHeureInputs();" >
													 	</a:support>
								                       </h:selectBooleanCheckbox>
					 </td>
				
				<td align="right">
			   	                  <h:outputText  value=" #{msgBundle['gestock.typeCommande']} " styleClass="grey" />
			   	                   <h:selectBooleanCheckbox value="#{venteService.venteEnCoures.ristourneON}"  
			   	                   disabled="#{venteService.venteEnCoures.getListeDetailVente().size()!=0}" /> 
			   	</td>
			   	<td align="right">
			   	    <a:outputPanel id="lab">
			   	   			      <h:outputText value="#{msgBundle['gestock.client']}  : " rendered="#{venteService.distributeurON}" styleClass="grey" />
			   	                  <h:outputText  value="#{msgBundle['gestock.distributeur']} : " rendered="#{not venteService.distributeurON}" styleClass="grey" />
			   	     </a:outputPanel>
			   	</td>
				<td>
				  <a:outputPanel id="idFournisseur">
				          
				             <h:inputText value="#{venteService.filtreNumClient}"  rendered="#{venteService.distributeurON}" styleClass="textBleu2" />
				            <a:commandLink status="waitStatus" rendered="#{venteService.distributeurON}" title="Recherche"
														action="#{venteService.rechercheClient}" reRender="zone2,infoFourni,lab,creation">
														<s:graphicImage fileName="loupe.png" style="border:0px;"
															value="/img2/loupe.png" width="20" height="20" alt="" />
																		  
							</a:commandLink> 
				   
					 <h:selectOneMenu rendered="#{not venteService.distributeurON}" valueChangeListener="#{venteService.recupereDistributeur}" disabled="false" styleClass="textBleu2"  id="dis" requiredMessage="Selectionnez...." converter="#{distributeurConverter}"  >
					     <s:selectItems  value="#{listeParamStock.listeDistributeur}" noSelectionLabel="Selectionnez...."  var="it" label="#{it.intitule}" />
						 <a:support  event="onchange"  ajaxSingle="true" reRender="zone2,infoFourni,lab,creation" />	
					</h:selectOneMenu> 
					
				  </a:outputPanel>
			   </td>
			</tr> 
			
			<tr>  
				<td colspan="4" width="100%"> 
				 <a:outputPanel id="infoFourni">
				    <fieldset>
						<legend>#{msgBundle['gestock.infoClient']}  </legend>
						<table width="100%">
							<tr>  
								<td height="20px"> <h:outputText value=" #{msgBundle['gestock.numClient']} :  " styleClass="grey" />
								 <h:outputText value="#{venteService.client.numeroClient}  " styleClass="grey" style="color:blue" />
								  <h:outputText value="#{venteService.distributeur.numeroDistributeur}  " rendered="#{not venteService.distributeurON}" styleClass="grey" style="color:blue" /> 
								</td>
								  
								<td> <h:outputText value="#{msgBundle['gestock.intitule']} :  " styleClass="grey" /> 
								      <h:outputText value="#{venteService.client.prenom} #{venteService.client.nom}  " rendered="#{venteService.distributeurON}" styleClass="grey" style="color:blue" /> 
								       <h:outputText value="#{venteService.distributeur.intitule}  " rendered="#{not venteService.distributeurON}" styleClass="grey" style="color:blue" /> </td>
							     
							     <td> <h:outputText value="#{msgBundle['gestock.tel']}:  " styleClass="grey" /> 
								      <h:outputText value="#{venteService.client.tel1}  " rendered="#{venteService.distributeurON}" styleClass="grey" style="color:blue" />
								      <h:outputText value="#{venteService.distributeur.tel1}  " rendered="#{not venteService.distributeurON}" styleClass="grey" style="color:blue" /> </td>
								  
							</tr>
							
							<tr>  
							
												
							    <td> <rich:spacer  height="20px" width="4px;" />  <h:outputText value="Email :  " styleClass="grey" /> 
								      <h:outputText value="#{venteService.client.email1}" rendered="#{venteService.distributeurON}"  styleClass="grey" style="color:blue" />
								       <h:outputText value="#{venteService.distributeur.email1}" rendered="#{not venteService.distributeurON}"  styleClass="grey" style="color:blue" /> </td>
								
								<td> 
								       <h:outputText value="#{msgBundle['gestock.montantAvoir']} : " styleClass="grey" />
								        <h:outputText rendered="#{venteService.distributeurON}"   value="#{venteService.client.montantAvoir}" style="color:blue ;font-size: large;font-weight: bold;"   > 
							    			<f:convertNumber pattern="#,###" />
										</h:outputText>
								        <h:outputText rendered="#{not venteService.distributeurON}"   value="#{venteService.distributeur.montantAvoir}" style="color:blue ;font-size: large;font-weight: bold;"   > 
							    			<f:convertNumber pattern="#,###" />
										</h:outputText>
										#{msgBundle['monnaie.unite']}
								</td>
								<td> <h:outputText value="#{msgBundle['gestock.ristoure']} :" styleClass="grey" /> 
										<h:outputText rendered="#{venteService.distributeurON}"  value="#{venteService.client.montantRistourne}" styleClass="grey" style="color:blue" >
									        	<f:convertNumber pattern="#,###" />
										</h:outputText>
										<h:outputText rendered="#{not venteService.distributeurON}"  value="#{venteService.distributeur.montantRistourne}" styleClass="grey" style="color:blue" >
									        	<f:convertNumber pattern="#,###" />
										</h:outputText>
										#{msgBundle['monnaie.unite']}
								 </td>
								
							</tr>
						</table>
						
			      </fieldset>
			      </a:outputPanel> 
			     </td>
			</tr>
			
			
			
			</table>
			
		</fieldset>
		<a:outputPanel id="creation"> 
		
		<a:outputPanel rendered="#{(venteService.client.idClient!=null) or (venteService.distributeur.idDistributeur!=null)}" > 
			<div style="height: 12px;" />
			<table width="100%" >
				<tr>
					<td width="1175px;"  align="right" >
						<div id="trd_submenu" class="trd_kb">
							<ul>
								<li>
									<a:commandLink  action="#{venteService.saveVente}" status="waitStatus" reRender="note"  value="" 	oncomplete="javascript:Richfaces.showModalPanel('modalPdf')" >
										<s:graphicImage fileName="accept.png" style="border:0px;" value="/picto/accept.png" width="16" height="16" alt="" />
										#{msgBundle['btn.valider']}
									</a:commandLink>
								</li>
								<li>
									<a:commandLink  action="#{venteService.annuler}" status="waitStatus" reRender="note"  value="">
										<s:graphicImage fileName="cross.png" style="border:0px;" value="/picto/cross.png" width="16" height="16" alt="" />
										Annuler
									</a:commandLink>
								</li>
							
							</ul>
						</div>
					</td>
					<td>
						&#160;
					</td>
				</tr>
			</table>
		
			
		   <fieldset>
			<legend>Detail Préparation </legend>
			
			
			<table width="100%" >
			  <tr>  
			    <td valign="top">
			       <fieldset>
						<legend>Liste Produit </legend>
						  <div style="height:200px;overflow: auto">
						 	<rich:dataTable value="#{venteService.caisseEncours.getListeStock()}" var="it"
								id="cc" style="width:100%;" rowClasses="row1,row2">
								<f:facet name="header">
									<rich:columnGroup>
									    <rich:column>
											<h:outputLabel value="#{msgBundle['gestock.operateur']} " style="color:white;font-size:12px;font-family: Arial;text-align:center;" />
										</rich:column>
										<rich:column>
											<h:outputLabel value="#{msgBundle['gestock.produit']} " style="color:white;font-size:12px;font-family: Arial;text-align:center;" />
										</rich:column>
											<rich:column>
											 <TABLE align="center" >  <tr >  <td align="center" >
											<h:outputLabel value="#{msgBundle['gestock.quantite']} " style="color:white;font-size:12px;font-family: Arial;text-align:center;" />
										    </td> </tr> </TABLE>
										</rich:column>
										<rich:column>
											<h:outputLabel value="choix " style="color:white;font-size:12px;font-family: Arial;text-align:center;" />
										</rich:column>
									</rich:columnGroup>
								</f:facet>
									<rich:column >
										<h:outputText value="#{it.operateur.intitule}"  />
								    </rich:column>
								    <rich:column >
										<h:outputText value="#{it.produit.libelle}"  />
								    </rich:column>
								     <rich:column >
										<h:outputText value="#{it.quantite}" styleClass="grey" />
								    </rich:column>
								    <rich:column >
								        <TABLE align="right" >  <tr >  <td align="right" >
									    <a:commandLink reRender="choix" status="waitStatus"  title="Sélectionner" rendered="#{it.quantite!=0}"
									                action="#{venteService.choixProduit(it)}" value=""
									                   >
									                   <s:graphicImage fileName="left32.png" style="border:0px;" value="/picto/left32.png" width="20" height="20" alt="Peupler" />
									     </a:commandLink>
									     </td>
									     </tr>
									     </TABLE>
								     </rich:column>
								    
							</rich:dataTable>
						</div>		
				   </fieldset>
				</td>
				
				 <td valign="top" >
				   <a:outputPanel id="choix">
			       <fieldset>
							<legend> #{msgBundle['gestock.produitSelect']} : 
							<h:outputText rendered="#{not (empty venteService.detailVenteEncours.produit)}" value="#{venteService.detailVenteEncours.produit.libelle}"   /> </legend>
							  <div  style="height:200px;overflow: auto">
							
							   <table>
								 
								<tr>  
								    <td > <h:outputText rendered="#{not (empty venteService.detailVenteEncours.produit)}"  value="Opérateur  :  " styleClass="grey" /> </td>
								    <td>  
										<h:outputText value="#{venteService.detailVenteEncours.operateur.intitule}"  style="color:blue ;font-size: large;font-weight: bold;" styleClass="textBleu2" />
								    </td>
								 </tr>  
								  <tr>  
								     <td > <rich:spacer  height="20px" width="4px;" />   <h:outputText rendered="#{not (empty venteService.detailVenteEncours.produit)}"  value="Produit  :  " styleClass="grey" /> </td>
								      <td > <rich:spacer  height="20px" width="4px;" />  <h:outputText rendered="#{not (empty venteService.detailVenteEncours.produit)}" value="#{venteService.detailVenteEncours.produit.libelle}" style="color:blue ;font-size: large;font-weight: bold;" styleClass="textBleu2" />  </td>
								</tr> 
								 <tr>  
								     <td > <rich:spacer  height="20px" width="4px;" />   <h:outputText rendered="#{not (empty venteService.detailVenteEncours.produit)}"  value="Quantité  :  " styleClass="grey" /> </td>
								      <td > <rich:spacer  height="20px" width="4px;" />  <h:inputText rendered="#{not (empty venteService.detailVenteEncours.produit)}" value="#{venteService.detailVenteEncours.quantite}"  styleClass="textBleu2 margBot10px nbOnly" />  </td>
								</tr> 
								
								<tr>
								      <td   align="center" colspan="2" >
								              <rich:spacer  height="20px" width="4px;" /> 
											<div id="trd_submenu" class="trd_kb" >
												<ul>
													<li>
														 <a:commandLink rendered="#{not (empty venteService.detailVenteEncours.produit)}"  action="#{venteService.ajouterProduit}" status="waitStatus"
																				  value="" reRender="note" >
																				<s:graphicImage fileName="accept.png" style="border:0px;" value="/picto/accept.png" width="16" height="16" alt="" />
																				Ajouter 
														 </a:commandLink>
													</li>
												
												</ul>
											</div>
										</td>
										<td>
											&#160;
										</td>
								</tr>
							</table>
					   </div>
				   </fieldset>
				    </a:outputPanel>
				</td>
				
			<td valign="top">
			       <fieldset>
						   <legend> #{msgBundle['gestock.vente']}   </legend>
						   <div style="height:200px;overflow: auto">
						   
						   	<rich:dataTable value="#{venteService.venteEnCoures.getListeDetailVente()}" var="it"
								id="comm" style="width:100%;" rowClasses="row1,row2">
								<f:facet name="header">
									<rich:columnGroup>
									    <rich:column>
											<h:outputLabel value="Operateur " style="color:white;font-size:12px;font-family: Arial;text-align:center;" />
										</rich:column>
										<rich:column>
											<h:outputLabel value="Libelle produit " style="color:white;font-size:12px;font-family: Arial;text-align:center;" />
										</rich:column>
										<rich:column>
											<h:outputLabel value="Quantite " style="color:white;font-size:12px;font-family: Arial;text-align:center;" />
										</rich:column>
										<rich:column>
											<h:outputLabel value="Prix U " style="color:white;font-size:12px;font-family: Arial;text-align:center;" />
										</rich:column>
										
										<rich:column>
											<h:outputLabel value="Montant Total" style="color:white;font-size:12px;font-family: Arial;text-align:center;" />
										</rich:column>
										<rich:column>
											<h:outputLabel value="Taux Ristourne " style="color:white;font-size:12px;font-family: Arial;text-align:center;" />
										</rich:column>
										<rich:column>
											<h:outputLabel value="Ristourne " style="color:white;font-size:12px;font-family: Arial;text-align:center;" />
										</rich:column>
										<rich:column>
											<h:outputLabel value="Supp" style="color:white;font-size:12px;font-family: Arial;text-align:center;" />
										</rich:column>
									</rich:columnGroup>
								</f:facet>
								    <rich:column >
										<h:outputText value="#{it.operateur.intitule}" styleClass="grey" />
								    </rich:column>
								    <rich:column >
										<h:outputText value="#{it.produit.libelle}" styleClass="grey" />
								    </rich:column>
								    <rich:column >
										<h:outputText value="#{it.quantite}" styleClass="grey" />
								    </rich:column>
								     <rich:column >
								        <TABLE align="right" >  <tr >  <td align="right" >
										<h:outputText value="#{it.prixUnitaire}" styleClass="grey" >
										   <f:convertNumber pattern="#,###" />
										</h:outputText>
										#{msgBundle['monnaie.unite']}
										</td> </tr>  </TABLE>
								    </rich:column>
								     <rich:column >
								       <TABLE align="right" >  <tr >  <td align="right" >
										<h:outputText value="#{it.montantTotal}" styleClass="grey" >
										  <f:convertNumber pattern="#,###" />
										</h:outputText>
										#{msgBundle['monnaie.unite']}
										</td> </tr>  </TABLE>
								    </rich:column>
								     <rich:column >
								        <TABLE align="center" >  <tr >  <td align="center" >
										<h:outputText value="#{it.tauxRistourne}" styleClass="grey" >
										</h:outputText>
										%
										</td> </tr>  </TABLE>
								    </rich:column>
								     <rich:column >
								        <TABLE align="right" >  <tr >  <td align="right" >
										<h:outputText value="#{(it.montantTotal * it.tauxRistourne)/100}" styleClass="grey" >
										   <f:convertNumber pattern="#,###" />
										</h:outputText>
										#{msgBundle['monnaie.unite']}
										</td> </tr>  </TABLE>
								    </rich:column>
								   
								    
								    <rich:column >
								        <TABLE align="right" >  <tr >  <td align="right" >
									    <a:commandLink reRender="tab2,comm,montant" status="waitStatus"  title="Sélectionner"
									                action="#{venteService.supprimerProduit(it)}" value=""
									                   >
									                   <s:graphicImage fileName="cross.png" style="border:0px;" value="/picto/cross.png" width="20" height="20" alt="Peupler" />
									 
									     </a:commandLink>
									     </td>
									     </tr>
									     </TABLE>
								     </rich:column>
								    
							</rich:dataTable>
						</div>
				   </fieldset>
				</td>
			    </tr>
		    </table>
			    
			    
		   </fieldset>
	 
		 <fieldset>
				<legend>  </legend>
				<a:outputPanel id="montant">
				    <table align="center" width="90%">
							  <tr>
							    <th align="right"><h:outputText value="Montant Total :" styleClass="grey" style="min-width:150px;"   /> </th>
							    <th> <h:outputText  value="#{venteService.venteEnCoures.getMontantAPaye()}" style="color:blue ;font-size: large;font-weight: bold;"   >
							     			 <f:convertNumber pattern="#,###" />
										</h:outputText>
										#{msgBundle['monnaie.unite']}
								 </th>
								 
								 
							 	<th align="right"><h:outputText value="Montant ristourne :" styleClass="grey" style="min-width:150px;"   /> </th>
							    <th> <h:outputText  value="#{venteService.venteEnCoures.getRistourne()}" style="color:blue ;font-size: large;font-weight: bold;"   > 
							    			<f:convertNumber pattern="#,###" />
										</h:outputText>
										#{msgBundle['monnaie.unite']}
								 </th>
							  </tr>
					</table>
				</a:outputPanel>

							 </fieldset>
		  </a:outputPanel>
	  </a:outputPanel>
				
			<rich:spacer height="20px;"> </rich:spacer>
		 
		
			
			
			
			</rich:panel>
			</div>
			</h:form>
		
			
	</ui:define>
</ui:composition>